<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/all.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap-grid.min.css' />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- <link rel="stylesheet" href="../css/indexFront.css"> -->
    <!-- 本機端css連結用下列: -->
    <!-- <link rel="stylesheet" href="./css/CustomizedBag_RWD.css"> -->
    <!-- git css連結用下列: -->
    <link rel="stylesheet" href="./css/pages/CustomizedBag_RWD.css">

    <!-- vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./js/CustomizedBag.js"></script>
    <!-- 購物提小燈箱 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <title>淨下塑湲|客製商品</title>
</head>

<body>
    <!-- 樣板 header   -->
    @@include('./layout/header.html')
    <!-- 會員登入 -->
    @@include('./layout/login.html')

    <section class="CustomizedBagPage">
        <div class="content_costomizedBag">
            <!-- header底下裝飾背景圖 -->
            <div class="customizedTotleBox">
                <!-- 左方麵包條 -->
                <div class="title-block">
                    <h5 class="title"><span>首頁/商城/</span>客製化商品</h5>
                </div>
                 <!-- 標題 -->
                <p>CUSTOMIZED BAG</p>
                <h5 class="title_2">客製化 - 購物袋</h5>
                <!-- <div class="yellowL"></div> -->
            </div>

            <!-- 頁面上半部:左側圖區  右側購物選單 -->
            <div class="container">
                <div class="row all justify-content-center">
                    <!-- ====================================左上側 客製商品區==================================== -->
                    <!-- ====================================左上側 客製商品區==================================== -->
                    <!-- ====================================左上側 客製商品區==================================== -->
                    <div class="col-xl-8 col-lg-8 col-md-12 col-sm-12 col-11 leftarea">
                        <div class="leftarea_block">
                            <!-- ============空白圖片區============ -->
                            <!-- ============空白圖片區============ -->
                            <!-- ============空白圖片區============ -->
                            <img src="./img/mall/bgimg.jpg" class="customizedBg_img">
                            <h6 class="urstyle">印上個人風格吧!</h6>

                            <div class="customized_area">
                                <img src="./img/mall/bag_white.png" class="customized_img" id="img_color">
                                
                                <!-- 放置上傳客製圖的div:前面 -->
                                <div class="image_front">
                                    <image id="image1"></image>
                                </div>
    
                                <!-- 放置上傳客製圖的div:背面 -->
                                <div class="image_back">
                                    <image id="image2"></image>
                                </div>
                                <p class="front">FRONT</p>
                                <p class="back">BACK</p>
                                
                            </div>
                            <!-- ============商品簡介區============ -->
                            <!-- ============商品簡介區============ -->
                            <!-- ============商品簡介區============ -->
                            <h6 class="aboutProducts">商品簡介</h6>
                            <img src="./img/mall/bottom.png" id="showInfo">
                            <div class="leftarea_block" id="showInforHere">
                                <p class="textaboutProducts">材質100％ 棉。輕薄的材質，收折方便且好攜帶。可手提、可肩背的設計增加便利性。可依喜好印製圖案，增加個人風格。</p>
                            </div>
                        </div>
                    </div>
                    <!-- ====================================右上側 選色選圖區==================================== -->
                    <!-- ====================================右上側 選色選圖區==================================== -->
                    <!-- ====================================右上側 選色選圖區==================================== -->
                    <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-11 rightarea">
                        <h6>訂製個人專屬商品吧!</h6>
                        <form action="" method="post" class="inforOfTheForm">
                            <!-- ==============選色區============== -->
                            <!-- ==============選色區============== -->
                            <!-- ==============選色區============== -->
                            <div class="color_block">
                                
                                <p class="stepExplain">STEP.1 - 請選擇商品顏色</p>
                                <!-- <p class="stepExplain">( 選色不需加價 )</p> -->
                                <div class="color_block1">
                                    <!-- 顏色色塊 -->
                                    <div class="ProductColor" id="color_btn_1">
                                        <div class="theColor theColor1"></div>
                                        <input type="radio" name="choiceTheColor" class="circleBtn" value="white">米白
                                    </div>
    
                                    <div class="ProductColor" id="color_btn_2">
                                        <div class="theColor theColor2"></div>
                                        <input type="radio" name="choiceTheColor" class="circleBtn" value="blue">天空藍
                                    </div>
    
                                    <div class="ProductColor" id="color_btn_3">
                                        <div class="theColor theColor3"></div>
                                        <input type="radio" name="choiceTheColor" class="circleBtn" value="green">環保綠
                                    </div>
    
                                    <div class="ProductColor" id="color_btn_4">
                                        <div class="theColor theColor4"></div>
                                        <input type="radio" name="choiceTheColor" class="circleBtn" value="pink">甜心粉
                                    </div>
    
                                    <div class="ProductColor" id="color_btn_5">
                                        <div class="theColor theColor5"></div>
                                        <input type="radio" name="choiceTheColor" class="circleBtn" value="navy">深海藍
                                    </div>
                                </div>
                            </div>
                            <!-- ==============傳圖區============== -->
                            <!-- ==============傳圖區============== -->
                            <!-- ==============傳圖區============== -->
                            <div class="picture_block">
                                <p class="stepExplain">STEP.2 - 上傳圖片至指定位置</p>
                                <p class="stepExplain stepExplain1">* 每個指定位置只能上一張圖片</p>
                                <!-- <p class="stepExplain stepExplain1">* 每上傳一張圖片需加價NT$100</p> -->
    
                                <div class="picture_block2">
                                    <div class="placement_of_product">
                                        <label class="placement">正面圖片:</lable>
                                        <div class="placememtOfInput">
                                            <input type="file" id="theFile1" class="theFileBtn">
                                        </div>
                                    </div>
    
                                    <div class="placement_of_product">
                                        <label class="placement">背面圖片:</lable>
                                        <div class="placememtOfInput">
                                            <input type="file" id="theFile2" class="theFileBtn">
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            <!-- ===========選擇數量區============= -->
                            <!-- ===========選擇數量區============= -->
                            <!-- ===========選擇數量區============= -->
                            <div class="qty_block">
                                <p class="stepExplain">STEP.3 - 請選擇購買數量</p>
                                <div class="placememtOfQty">
                                    <label class="style_qty">數量-</label>
                                    <!-- <select class="select_qty_pcs" name="select_qty_pcs">
                                        <option value="1" selected>1</option>
                                        <option value="2" >2</option>
                                    </select> -->

                                    <input type='button' value='-' class='select_qty_pcs qtyminus qtyBtn' field='quantity' />
                                    <input type='text' name='quantity' value='1' class='select_qty_pcs qty' />
                                    <input type='button' value='+' class='select_qty_pcs qtyplus qtyBtn' field='quantity' />
                                    
                                    </div>
                                </div>
                            <!-- =============小計區=============== -->
                            <!-- =============小計區=============== -->
                            <!-- =============小計區=============== -->
                            <div class="tal_block">
                                    <p class="stepExplain"></p>
                                    <div class="placementOfTal">
                                        <label class="thePrice"></label><label>NT$<span>500</span></label>
                                    </div>
                                </div>
    
                                <div class="placeOfSubmit">
                                    <button type="submit" name="shopping_cart" class="btn_shopping_cart">加入購物車
                                    <i class="fas fa-shopping-cart"></i>
                                    </button>
                                </div>
                        </form>
                        <!-- </div> -->
                    </div>
                </div>
                <!-- =====================================下側 推薦商品區===================================== -->
                <!-- =====================================下側 推薦商品區===================================== -->
                <!-- ========標題======== -->
                <div class="row all2_Bottom justify-content-center">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-10 bottomarea">
                        <p>HOT PRODUCTS</p>
                        <h5 class="title_2">熱門推薦商品</h5>
                        <div class="newProLine"></div>
                        <!-- ====================放置動態「推薦商品」的卡片==================== -->
                        <div id="appNewProd" class="addDivForVue">
                            <!-- ================= -->
                            <div v-for="NewProdRow in NewProdRows" class="product" v-bind:id="NewProdRow.PRODNO">
                                <a href="NormalProduct_RWD.html">
                                    <img :src="NewProdRow.PRODPIC_1">
                                </a>
                                <div class="productInfo">
                                    <p class="NameAndPrice">{{NewProdRow.PRODNAME}}</p>
                                    <p class="NameAndPrice">NT$
                                        <span class="price">{{NewProdRow.PRODPRICE}}</span>
                                        <button class="CartBtnOfMall" v-bind:id="NewProdRow.PRODNO">
                                            <i class="fas fa-shopping-cart fa-1x"></i>
                                            <p>加入購物車</p>
                                        </button>
                                    </p>
                                </div>
                            </div>
                            <!-- =================放置動態「推薦商品」的卡片//================= -->
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <script>
        //===========加or減 購買數量 切換===========:
        //===========加or減 購買數量 切換===========:
        $(function() {
            $('.qtyplus').click(function(e) {
                e.preventDefault();
                fieldName = $(this).attr('field');
                var currentVal = parseInt($('input[name=' + fieldName + ']').val());
                if (!isNaN(currentVal)) {
                $('input[name=' + fieldName + ']').val(currentVal + 1);
                } else {
                $('input[name=' + fieldName + ']').val(0);
                }
            });
            $(".qtyminus").click(function(e) {
                e.preventDefault();
                fieldName = $(this).attr('field');
                var currentVal = parseInt($('input[name=' + fieldName + ']').val());
                if (!isNaN(currentVal) && currentVal > 0) {
                $('input[name=' + fieldName + ']').val(currentVal - 1);
                } else {
                $('input[name=' + fieldName + ']').val(0);
                }
            });
        });

        //切換衣服顏色
        $(document).ready(function() {
            $('#color_btn_1').click(function() {
                $('#img_color').attr('src', './img/mall/bag_white.png');
            });

            $('#color_btn_2').click(function() {
                $('#img_color').attr('src', './img/mall/bag_blue.png');
            });

            $('#color_btn_3').click(function() {
                $('#img_color').attr('src', './img/mall/bag_green.png');
            });

            $('#color_btn_4').click(function() {
                $('#img_color').attr('src', './img/mall/bag_pink.png');
            });

            $('#color_btn_5').click(function() {
                $('#img_color').attr('src', './img/mall/bag_navy.png');
            });
        });

        //商品簡介 切換:
        $(document).ready(function(){
           $('#showInfo').click(function(){
                $('#showInforHere').slideToggle();
                // $('.right_04').fadeToggle();
          })
      });

    </script>

    <!-- 樣板 footer -->
    @@include('./layout/footer.html')
    <script src="./js/login.js"></script>

    <script>
        // ------------------------到資料庫撈取「推薦商品卡片」要的資料---------------------
        function getNewProducts(){
            let xhrNewProuct = new XMLHttpRequest();
            xhrNewProuct.onload = function(){
                NewProdRows = JSON.parse(xhrNewProuct.responseText);
                appNewProd.NewProdRows = NewProdRows;
            }
            xhrNewProuct.open("get", "./php/mall/getNewProducts.php", true);
            xhrNewProuct.send(null);
        }
        // ------------------------把撈取到的推薦商品動態渲染到「推薦商品卡片」-------------
        var appNewProd = new Vue({
            el: '#appNewProd',
            data: {
                NewProdRows: [],
            },
            mounted(){
                let storage = sessionStorage;
                //ItemId : for商城記錄click到哪個商品
                if(storage['ItemId'] == null){
                    storage['ItemId'] = '';
                }
                //addItemList : for購物車記錄把哪個商品加到購物車
                if(storage['addItemList'] == null){
                    storage['addItemList'] = '';
                }
                setTimeout(()=>{
                    //幫每張卡片(一般商品+推薦商品)建立事件聆聽功能
                    let prodCard = document.querySelectorAll('.product');
                    for(let i = 0; i < prodCard.length; i++){
                        prodCard[i].addEventListener('click',function(){
                            theId = this.id;
                            storage.setItem('ItemId',theId);
                        });
                    }
                    // ********click「Cart Btn」, 就把 那個產品資訊存入Session********
                    //-----------------------------註冊放入購物車
                    // ************************************************************************************
                    let cart;
                    if(storage.getItem('cart') == null){
                        cart = [];
                    }else{
                        cart = JSON.parse(storage['cart']);
                    }
                    let CartBtn = document.querySelectorAll('.CartBtnOfMall');
                            //--------session記錄購物資訊-----更新storage的購物資訊
                    function updateCart(){
                        storage["cart"] = JSON.stringify(cart);
                    }
                    for(let i=0; i<CartBtn.length; i++){
                        CartBtn[i].onclick = function(e){
                            // let prodNo = e.target.id;(原寫法)
                            let prodNo = this.parentNode.parentNode.parentNode.id;
                            //---------檢查商品是否已在cart中
                            let exist = false;
                            for(let i=0; i<cart.length; i++){
                                if(cart[i].prodNo == prodNo){
                                    exist = true;
                                    break;
                                }
                            }
                            //---------
                            if(exist){
                                alert("購物車內已有此商品囉!");
                            }else{
                                let item = {};
                                item.prodNo = prodNo;
                                item.prodName = e.target.parentNode.parentNode.parentNode.firstChild.innerText;
                                item.src = e.target.parentNode.parentNode.parentNode.parentNode.querySelector("img").src;
                                item.price = e.target.parentNode.previousElementSibling.innerText;
                                item.count = 1;
                                cart.push(item);
                                updateCart();
                                alert("已成功加入購入車囉!");
                                // Swal.fire({
                                //     position: 'center-center',
                                //     title: '商品已成功加入購物車！',
                                //     icon: 'success',
                                //     showConfirmButton: false,
                                //     timer: 1500
                                // }) 
                            }
                        }
                    }
                },1000)
            },
        });
        // ------------------------------------------------------------------------------
        window.addEventListener("load", function(){
            // 執行:撈取「推薦商品」函式
            getNewProducts();
        })
    </script>
</body>
</html>