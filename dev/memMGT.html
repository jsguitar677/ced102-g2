<!DOCTYPE html>
<html lang="zn-Hant">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend</title>
    <!-- icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">
    <!-- 打包連接的css -->
    <link rel="stylesheet" href="./css/pages/memMGT.css">
    <!-- 自己開watch sass連接的css，如果不用請把下面註解，上面打開-->
    <!-- <link rel="stylesheet" href="./css/memMGT.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js'></script>
    <script src="./js/common_backend.js"></script>
    <script src="./js/memMGT.js"></script>
</head>
<body>
    @@include('./layout/backend_header.html')
    <div class="bg">
        <main id="backend">
            <aside class="tags">
                <div class="t1 tag"><a href="./admMGT.html"><div class="circle"></div>管理員管理</a></div>
                <div class="t2 tag current"><a><div class="circle"></div>會員管理</a></div>
                <div class="t3 tag"><a href="./prodMGT.html"><div class="circle"></div>商品管理</a></div>
                <div class="t4 tag"><a href="./orderMGT.html"><div class="circle"></div>訂單管理</a></div>
                <div class="t5 tag"><a href="./rptMGT.html"><div class="circle"></div>檢舉留言管理</a></div>
                <div class="t6 tag"><a href="./actMGT.html"><div class="circle"></div>活動審核管理</a></div>
                <div class="t7 tag"><a href="./act_histMGT.html"><div class="circle"></div>活動花絮管理</a></div>
                <span class="text">© 淨下塑湲 All Rights Reserved. <br>淨下塑湲版權所有不得轉載</span>
            </aside>
            <div class="content">
                <section id="c2">
                    <h1>會員管理</h1>
                    <div class="flex">
                        <div class="search"><i class="fas fa-search"></i><input class="search" type="text" name="search" placeholder='請輸入編號或名稱'></div>
                    </div>
                    <!-- <table>
                        <thead>
                            <tr>
                                <th>編號</th>
                                <th>姓名</th>
                                <th>等級</th>
                                <th>帳號(信箱)</th>
                                <th>生日</th>
                                <th>手機</th>
                                <th>環保幣</th>
                                <th>經驗值</th>
                                <th>狀態</th>
                                <th>違規停權</th>
                                <th>刪除</th>
                            </tr>
                        </thead>
                        <tbody class="list" id="mem-tbody">
                            <tr id="mem1">
                                <td><div class="no-block mem-num" id="BCMBRNO">1</div></td>
                                <td class="mem-name" id="BCMBRNAME">Herry Chen</td>
                                <td id="BCMLEVEL">一般會員</td>
                                <td id="BCMBRMAIL">Herry123</td>
                                <td id="BCMBRBIRTH">2000/09/09</td>
                                <td id="BCMBRPHONE">0945090909</td>
                                <td id="BCMBRCOIN">66</td>
                                <td id="BCMBREXP">203</td>
                                <td id="BCMBRSTATE">停權</td>
                                <td>
                                    <label class="toggle-btn" for="suspension1">
                                        <input type="checkbox" id="suspension1" checked hidden>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <div class="delete-icon"><i class="fas fa-trash"></i></div>
                                </td>
                            </tr>
                            <tr id="mem2">
                                <td><div class="no-block mem-num">2</div></td>
                                <td class="mem-name">Amy Lin</td>
                                <td>一般會員</td>
                                <td>AMY123</td>
                                <td>2001/02/06</td>
                                <td>0945090777</td>
                                <td>0</td>
                                <td>20</td>
                                <td>正常</td>
                                <td>
                                    <label class="toggle-btn" for="suspension2">
                                        <input type="checkbox" id="suspension2" hidden>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <div class="delete-icon"><i class="fas fa-trash"></i></div>
                                </td>
                            </tr>
                        </tbody>
                    </table> -->
                    <div id="showPanel"></div>
                    <div class="alert-block alert-block-delete">
                        <form id="mem-delete" class="alert">
                            <input type="text" name="mbrno" hidden>
                            <p>您確定要將會員編號<span class="mbrno"></span>刪除?</p>
                            <p class="highlight">一經刪除便無法復原</p>
                            <div class="cancel-btn btn">取消</div>
                            <button type="submit" class="submit btn">確認</button>
                        </form>
                    </div>
                    <div class="alert-block alert-block-stop">
                        <form id="mem-stop" class="alert">
                            <input type="text" name="mbrno" hidden>
                            <p>您確定要將會員編號<span class="mbrno"></span><span id="stop-text">停權?</span></p>
                            <p class="highlight">請確認會員違規情形</p>
                            <div class="btn" id="stop-cancel">取消</div>
                            <button type="submit" class="submit btn">確認</button>
                        </form>
                    </div>
                </section>
            </div>
        </main>
    </div>
    <script>
        //展示從資料庫抓取的會員資料
        function showMember(jsonStr){
        //將PHP送過來的JSON字串轉為JS物件
          let member = JSON.parse(jsonStr); //{}
          let html;
            html = 
            `<table>
                <thead>
                    <tr>
                        <th>編號</th>
                        <th>姓名</th>
                        <th>等級</th>
                        <th>帳號(信箱)</th>
                        <th>生日</th>
                        <th>手機</th>
                        <th>環保幣</th>
                        <th>經驗值</th>
                        <th>狀態</th>
                        <th>違規停權</th>
                        <th>刪除</th>
                    </tr>
                </thead>`;
                let tbodyLeftTot = "";
                for(let i=0;i<member.length;i++){
                    tbodyLeftTot += `<tbody class="list">
                        <tr id="mem1">
                            <td><div class="no-block mem-num" id="BCMBRNO${i+1}">${i+1}</div></td>
                            <td class="mem-name" id="BCMBRNAME">${member[i]["MBRNAME"]}</td>
                            <td id="BCMLEVEL" class="LevelJudge">${member[i]["MBREXP"]}</td>
                            <td id="BCMBRMAIL">${member[i]["MBRMAIL"]}</td>
                            <td id="BCMBRBIRTH">${member[i]["MBRBIRTH"]}</td>
                            <td id="BCMBRPHONE">${member[i]["MBRPHONE"]}</td>
                            <td id="BCMBRCOIN"${member[i]["mbrcoin"]}</td>
                            <td id="BCMBREXP">${member[i]["MBREXP"]}</td>
                            <td id="BCMBRSTATE">${member[i]["MBRSTAT"]}</td>
                            
                            <td>
                                <label class="toggle-btn" for="suspension1">
                                    <input type="checkbox" id="suspension1" checked hidden>
                                    <span class="slider"></span>
                                </label>
                            </td>
                            <td>
                                <div class="delete-icon"><i class="fas fa-trash"></i></div>
                            </td>
                        </tr>
                    </tbody>`;
                    }
          html = html + tbodyLeftTot + `</table>`;
          //將從Server端抓取的資料展示到"showPanel"裡
          document.getElementById("showPanel").innerHTML = html;
          //由會員經驗值判斷身分為"一般會員"或"資深會員"
          let LevelJudge = document.getElementsByClassName('LevelJudge');
          for(let i=0; i<LevelJudge.length; i++){
              if (LevelJudge[i].innerHTML == null || LevelJudge[i].innerHTML < 100){
                LevelJudge[i].innerHTML = "一般會員";
              }else{
                LevelJudge[i].innerHTML = "資深會員";
              }
          }
        }
        
        function getMember(){
          var xhr = new XMLHttpRequest();//1.使用Ajax必須使用此物件
          xhr.onload=function (){
               if( xhr.status == 200 ){
                //modify here
                console.log( xhr.responseText);
                showMember(xhr.responseText);
               }else{
                  alert( xhr.status );
               }
          }
          
          var url = "./php/2/memMGT.php";
          xhr.open("Get", url, true);
          xhr.send( null );
        }
        window.addEventListener('load', getMember);
        </script>
</body>
</html>