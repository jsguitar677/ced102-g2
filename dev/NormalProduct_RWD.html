<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/all.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap-grid.min.css'/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- <link rel="stylesheet" href="../css/indexFront_RWD.css"> -->
    <!-- 本機端css連結用下列: -->
    <!-- <link rel="stylesheet" href="./css/NormalProduct_RWD.css"> -->
    <!-- git css連結用下列: -->
    <link rel="stylesheet" href="./css/pages/NormalProduct_RWD.css">

    <!-- vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>淨下塑湲|一般商品</title>
</head>

<body>
    <!-- 樣板 header   -->
    @@include('./layout/header.html')
    <!-- 會員登入 -->
    @@include('./layout/login.html')

    <section class="NormalProductPage">
        <div class="content_normalProduct">
            <!-- header底下裝飾背景圖 -->
            <div class="customizedTotleBox">
                <!-- 左方麵包條 -->
                <div class="title-block">
                    <h5 class="title"><span>首頁/商城/</span>一般商品</h5>
                </div>
                <!-- 標題 -->
                <p>Normal Product</p>
                <h5 class="title_2">一般商品</h5>
                <div class="yellowL"></div>
            </div>

            <!-- 頁面上半部:左側圖區  右側購物選單 -->
            <div class="container">
                <div class="row all justify-content-center" id="app">
                    <!-- ====================================左上側 商品展示區==================================== -->
                    <!-- ====================================左上側 商品展示區==================================== -->
                    <!-- ====================================左上側 商品展示區==================================== -->
                    <div class="col-xl-8 col-lg-8 col-md-12 col-sm-12 col-11 leftarea">
                        <div class="leftarea_blockA">
                        <!-- ============展示圖片區============ -->
                        <!-- ============展示圖片區============ -->
                            <div class="leftarea_blockA_L" id="NP_ZoomIn1" @click.stop="getURL">
                                <img :src="theProdRow.PRODPIC_1">
                                <div class="explain">放大檢視</div>
                            </div>
                            <!-- ------------------- -->
                            <div class="leftarea_blockA_R">
                                <div class="leftarea_blockA_R1" id="NP_ZoomIn2">
                                    <img :src="theProdRow.PRODPIC_2" @click.stop="getURL">
                                    <div class="explain">放大檢視</div>
                                </div>
                                <div class="leftarea_blockA_R1" id="NP_ZoomIn3">
                                    <img :src="theProdRow.PRODPIC_4" @click.stop="getURL">
                                    <div class="explain">放大檢視</div>
                                </div>
                                <div class="leftarea_blockA_R1 leftarea_blockA_R11" id="NP_ZoomIn4">
                                    <img :src="theProdRow.PRODPIC_3" @click.stop="getURL">
                                    <div class="explain">放大檢視</div>
                                </div>
                                <div class="leftarea_blockA_R1 leftarea_blockA_R11" id="NP_ZoomIn5">
                                    <img :src="theProdRow.PRODPIC_5" @click.stop="getURL">
                                    <div class="explain">放大檢視</div>
                                </div>
                            </div>
                        </div>
                        <!-- ============商品簡介區============ -->
                        <!-- ============商品簡介區============ -->
                        <div class="leftarea_blockB" >
                            <h6 class="aboutProducts">商品簡介</h6>
                            <img src="./img/mall/bottom.png" id="showInfo">
                            <p class="textaboutProducts" id="showInforHere">{{theProdRow.PRODBIO}}</p>
                        </div>
                    </div>
                    <!-- ====================================右上側 選購數量區==================================== -->
                    <!-- ====================================右上側 選購數量區==================================== -->
                    <!-- ====================================右上側 選購數量區==================================== -->
                    <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-11 rightarea">
                        <!-- ============================== -->
                        <form action="cart.html" method="get" class="inforOfTheForm" id="theForm">
                            <!-- ===========商品選購區============= -->
                            <!-- ===========商品選購區============= -->
                            <div class="qty_block">
                                <p class="stepExplain">請選擇購買數量</p>
                                <!-- <p>商品編號:</p><span>{{theProdRow.PRODNO}}</span> -->
                                <p class="prodNumber prodNumberA">(商品編號:</p> <p class="prodNumber" id="prodNo">{{theProdRow.PRODNO}}</p> <p class="prodNumber">)</p>
                                <!-- ========價格區(小計先拿掉)======== -->
                                <!-- ========價格區(小計先拿掉)======== -->
                                <div class="tal_block">
                                    <!-- <p class="stepExplain">小計</p> -->
                                    <div class="placementOfTal">
                                        <label class="thePrice">NT$</label><label>{{theProdRow.PRODPRICE}}</label>
                                        <br>
                                    </div>
                                </div>
                                <!-- ===========選擇數量區============= -->
                                <!-- ===========選擇數量區============= -->
                                <div class="placememtOfQty">
                                    <label class="style_qty">數量</label>
                                    <select class="select_qty_pcs" name="select_qty_pcs">
                                        <option value="1" selected>1</option>
                                        <option value="2" >2</option>
                                        <option value="3" >3</option>
                                        <option value="4" >4</option>
                                        <option value="5" >5</option>
                                        <option value="6" >6</option>
                                        <option value="7" >7</option>
                                        <option value="8" >8</option>
                                        <option value="9" >9</option>
                                        <option value="10" >10</option>
                                        <option value="11" >11</option>
                                        <option value="12" >12</option>
                                        <option value="13" >13</option>
                                        <option value="14" >14</option>
                                        <option value="15" >15</option>
                                        <option value="16" >16</option>
                                        <option value="17" >17</option>
                                        <option value="18" >18</option>
                                        <option value="19" >19</option>
                                        <option value="20" >20</option>
                                    </select>
                                </div>
                            </div>
                            <!-- ===========CART按鈕區============= -->
                            <!-- ===========CART按鈕區============= -->
                            <div class="placeOfSubmit">
                                <a href="">
                                    <button type="submit" name="shopping_cart" class="btn_shopping_cart" id="'a'+submitToCart">加入購物車
                                        <i class="fas fa-shopping-cart fa-1x"></i>
                                    </button>
                                </a>
                            </div>
                        </form>
                    </div>
                    <!-- =======================燈箱 : 商品放大展示================================ -->
                    <!-- =======================燈箱 : 商品放大展示================================ -->
                    <!-- =======================燈箱 : 商品放大展示================================ -->
                    <div class="NP_showBox_bg" id="NP_lightBox">
                        <div class="NP_showBox">
                            <img :src="theImage" class="NP_showHere" id="NP_showImgHere">
                            <img src="./img/mall/x_white.png" class="NP_turnOffBtn" id="NPtheTurnOffBtn" @click="closeBox">
                        </div>
                    </div>
                </div>
                
                <!-- ===========================「推薦商品」的卡片=========================== -->
                <!-- ===========================「推薦商品」的卡片=========================== -->
                <div class="row all_Bottom justify-content-center">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-10 bottomarea">
                        <p>HOT PRODUCTS</p>
                        <h5 class="title_2">熱門推薦商品</h5>
                        <div class="newProLine"></div>
                        <!-- ====================放置動態「推薦商品」的卡片==================== -->
                        <div id="appNewProd" class="bottomareaBoxA">
                            <!-- --------- -->
                            <div v-for="NewProdRow in NewProdRows" class="product" v-bind:id="NewProdRow.PRODNO">
                                <img :src="NewProdRow.PRODPIC_1" class="theImg">
                                <div class="productInfo">
                                    <p class="NameAndPrice">{{NewProdRow.PRODNAME}}</p>
                                    <p class="NameAndPrice">NT$
                                        <span class="price">{{NewProdRow.PRODPRICE}}</span>
                                        <button class="CartBtnOfMall">
                                            <i class="fas fa-shopping-cart fa-1x"></i>
                                            <p>加入購物車</p>
                                        </button>
                                    </p> 
                                </div>
                            </div>
                            <!-- --------- -->
                        </div>
                        <!-- ====================放置動態「推薦商品」的卡片//================== -->
                    </div>
                </div>
                <!-- ===========================「推薦商品」的卡片//========================= -->
                <!-- ===========================「推薦商品」的卡片//========================= -->
            </div>
        </div>
    </section> 

    <script>
        //===========商品簡介 切換===========:
        //===========商品簡介 切換===========:
        $(function(){
            $('#showInfo').click(function(){
                    $('#showInforHere').slideToggle();
            })
        });
    </script>

    <script>
        // ================(A1) 先到session取值，判斷(前一頁)商城是哪個商品被click========
        // ================(A1) 先到session取值，判斷(前一頁)商城是哪個商品被click========
        let id;
        function doFirst(){
            let storage = sessionStorage;
            if(storage['ItemId'] == null){
                storage['ItemId'] = '';
            }
            let showTheProd = storage.getItem('ItemId');
            //console.loge(showTheProd);
            id = showTheProd;
            // alert(id );
            storage['ItemId'] = '';
        }
        // ================(A2) 依照從session上取到的值(即商品編號)去抓資料庫=============
        // ================(A2) 依照從session上取到的值(即商品編號)去抓資料庫=============
        function showProd(){
            let xhrShowProd = new XMLHttpRequest();
            xhrShowProd.onload = function(){
                theProdRow = JSON.parse(xhrShowProd.responseText);
                app.theProdRow = theProdRow;
            }
            xhrShowProd.open("get", `./php/mall/showTheProduct.php?id=${id}`, true);
            xhrShowProd.send(null);
        }
        // ================(A3) 把資料庫抓到的指定商品渲染到頁面上========================
        // ================(A3) 把資料庫抓到的指定商品渲染到頁面上========================
        var app = new Vue({
            el: '#app',
            data: {
                theProdRow: [],
                theImage: '',
            },
            methods:{
                // =========燈箱開關=========
                getURL(e){
                    $('#NP_lightBox').css('display','block');
                    this.theImage = e.target.src;
                },
                closeBox(){
                    $('#NP_lightBox').css('display','none');
                },
            },
         });
        // ================(B1)) 到資料庫取資料放到「推薦商品區」=============
        // ================(B1) 到資料庫取資料放到「推薦商品區」=============
        function getNewProducts(){
            let xhrNewProuct = new XMLHttpRequest();
            xhrNewProuct.onload = function(){
                NewProdRows = JSON.parse(xhrNewProuct.responseText);
                appNewProd.NewProdRows = NewProdRows;
            }
            xhrNewProuct.open("get", "./php/mall/showHotProduct.php", true);
            xhrNewProuct.send(null);
        }
        // ================(B2) 把資料庫取得的資料渲染到「推薦商品區」=======
        // ================(B2) 把資料庫取得的資料渲染到「推薦商品區」=======
        var appNewProd = new Vue({
            el: '#appNewProd',
            data: {
                NewProdRows: [],
            },
            // click本頁面下方的「推薦商品」後，上方「展示區」要顯示被click到的「推薦商品」
            mounted(){
                let storage = sessionStorage;

                //ItemId : for商城記錄click到哪個商品
                if(storage['ItemId'] == null){
                    storage['ItemId'] = '';
                }
                setTimeout(()=>{
                    //先幫每張推薦的圖片 建立事件聆聽功能
                    let prodCard = document.querySelectorAll('.theImg');
                    for(let i = 0; i < prodCard.length; i++){
                        prodCard[i].addEventListener('click',function(){
                            // theId = this.id;
                            var theId = this.parentNode.id;
                            storage.setItem('ItemId',theId);
                            let showTheProd = storage.getItem('ItemId');
                            //取出session的值
                            id = showTheProd;
                            //執行function showProd()
                            showProd();
                            //把session裡key為ItemId的值清掉
                            storage['ItemId'] = '';
                            // ------------
                        });
                    }
                    // ********click「Cart Btn」, 就把 那個產品資訊存入Session********
                    //-----------------------------註冊放入購物車
                    let cart=[];
                    let CartBtn = document.querySelectorAll('.CartBtnOfMall');
                    for(let i=0; i<CartBtn.length; i++){
                        CartBtn[i].onclick = function(e){
                            // let prodNo = e.target.id;(原寫法)
                            let prodNo = this.parentNode.parentNode.parentNode.id;
                            //---------檢查商品是否已在cart中
                            let exist = false;
                            for(let i=0; i<cart.length; i++){
                                if(cart[i].prodNo == prodNo){
                                    exist = true;
                                    break;
                                }
                            }
                            //---------
                            if(exist){
                                alert("購物車內已有此商品囉!");
                            }else{
                                let item = {};
                                item.prodNo = prodNo;
                                item.prodName = e.target.parentNode.parentNode.parentNode.firstChild.innerText;
                                item.src = e.target.parentNode.parentNode.parentNode.parentNode.querySelector("img").src;
                                item.price = e.target.parentNode.previousElementSibling.innerText;
                                item.count = 1;
                                cart.push(item);
                                updateCart(); 
                            }
                            //--------session記錄購物資訊-----更新storage的購物資訊
                            function updateCart(){
                                storage["cart"] = JSON.stringify(cart);
                            }
                        }
                    }
                    //----------------------------
                },50)
            }
        });
        // ----------------------------------------------------------------------------
        window.addEventListener("load", function(){
        // 執行:撈取「session裡的value」函式
        doFirst();  
        // 執行:依session的值去抓資料庫
        showProd();
        // 執行:撈取「推薦商品」函式
        getNewProducts();
    })
    </script>

    <!-- 樣板 footer -->
    @@include('./layout/footer.html')
    <script src="./js/login.js"></script>
</body>
</html>