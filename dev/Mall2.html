<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/all.css">

    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap-grid.min.css'/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- 本機端css連結用下列: -->
    <!-- <link rel="stylesheet" href="./css/Mall3.css"> -->
    <!-- git css連結用下列: -->
    <link rel="stylesheet" href="./css/pages/Mall3.css">

    <!-- <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap-grid.min.css' /> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->

    <!-- vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <!-- icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">
    <!-- 輪播圖 -->
    <link rel="stylesheet" href="./plugin/swiper-bundle.css" />
    <title>淨下塑湲|商城</title>
</head>

<body>
    <!-- 樣板 header   -->
    @@include('./layout/header.html')
    <!-- 會員登入 -->
    @@include('./layout/login.html')

    <section>
        <div class="content_Mall">
            <!-- =======================BANNER : 客製商品區========================== -->
            <!-- =======================BANNER : 客製商品區========================== -->
            <div class="homePage4__customerBlock">
                    <!-- =====麵包條===== -->
                    <div class="titleBlock">
                        <span>首頁/</span>
                        <span class="currentPage">商城</span>
                    </div>
                <div class="sizeBox">
                    <div id="swiper3" class="swiper-container">
                        <div class="swiper-wrapper">
                            <!-- ============================= -->
                            <div class="swiper-slide cusSwiper" >
                                <div class="productBanner">
                                    <a href=""><img src="./img/mall/ad_1.jpg"></a>
                                </div>
                                <div class="page4RightText">
                                    <div class="page4Title">
                                        <p>CUSTOMIZED PRODUCTS</p>
                                        <h5>客製化商品</h5>
                                    </div>
                                    <h5>快來訂製專屬自己的環保購物包吧</h5>
                                    <p>主要原材料為天然棉布、帆布、和麻混紡而成。因應環保概念，購物袋已經成為時尚潮流，欣賞獨特設計作品的同時，也快來訂製專屬於自己的潮流環保購物包吧!</p>
                                    <a class="comBtn2" href="./CustomizedBag_RWD.html">前往客製化更多</a>
                                </div>
                            </div>
                            <!-- ============================= -->
                            <div class="swiper-slide cusSwiper" >
                                <div class="productBanner">
                                    <a href=""><img src="./img/mall/ad_4.jpg"></a>
                                </div>
                                <div class="page4RightText">
                                    <div class="page4Title">
                                        <p>CUSTOMIZED PRODUCTS</p>
                                        <h5>客製化商品</h5>
                                    </div>
                                    <h5>快來訂製專屬自己的環保購物包吧</h5>
                                    <p>主要原材料為天然棉布、帆布、和麻混紡而成。因應環保概念，購物袋已經成為時尚潮流，欣賞獨特設計作品的同時，也快來訂製專屬於自己的潮流環保購物包吧!</p>
                                    <a class="comBtn2" href="./CustomizedBag_RWD.html">前往客製化更多</a>
                                </div>
                            </div>
                            <!-- ============================= -->
                            <div class="swiper-slide cusSwiper" >
                                <div class="productBanner">
                                    <a href=""><img src="./img/mall/bag1.jpg"></a>
                                </div>
                                <div class="page4RightText">
                                    <div class="page4Title">
                                        <p>CUSTOMIZED PRODUCTS</p>
                                        <h5>客製化商品</h5>
                                    </div>
                                    <h5>挑選你喜愛的顏色吧</h5>
                                    <p>主要原材料包括無紡布、天然棉布、帆布、牛仔布和麻等製成的，也有用特製的紙製成。因應環保概念，環保購物袋已經成為時尚潮流。世界各地時尚品牌紛紛推出不同款式環保袋。</p>
                                    <a class="comBtn2" href="./CustomizedBag_RWD.html">前往客製化更多</a>
                                </div>
                            </div>
                            <!-- ============================= -->
                        </div>
                        <!-- Add Arrows -->
                        <div id="cusSwipersBtnR" class="swiper-button-next"></div>
                        <div id="cusSwipersBtnL" class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            
            <!-- ====================== 一般商品區 =========================== -->
            <!-- ====================== 一般商品區 =========================== -->
            <!-- ========標題======== -->
            <div class="newsPorTitle">
                <p>PORDUCTS</p>
                <h5>一般商品</h5>
                <div class="newProLine"></div>
            </div>

            <div class="sizeBoxB">
                <div class="productBlock" id="user">
                    <!-- ==================================篩選區================================== -->
                    <div class="productType">
                        <div class="typeTitle"><span>一般商品種類</span></div>
                        <button class="type" id="allNormalProd">所有一般商品</button>
                        <button class="type" id="ShopingBagProd">購物袋</button>
                        <button class="type" id="CupsetProd">杯套</button>
                        <button class="type" id="FacemaskProd">口罩</button>
                        <button class="type" id="PhonecaseProd">手機殼</button>
                        <button class="type" id="TshirtProd">上衣</button>
                        <button class="type" id="HatProd">帽子</button>
                    </div>

                    <div class="allProduct" >
                        <!-- ==============================排序區================================== -->
                        <div class="theWayOfSort">
                            <select class="select_sort_way" name="select_sort_way">
                                <!-- <option class="sortWay" selected disabled><div class="sortByProdNo">請選擇排序方式</div></option> -->
                                <option class="sort sortbyProdNo" value="0" id="BtnSortByProdNo" selected disabled>請選擇排序方式</option>
                                <option class="sort sortbyListedDate" value="1" id="BtnSortByListedDate">新品上市</option>
                                <option class="sort sortByPriceAsc" value="2" data-sort="price" id="BtnSortByPrice">價格低至高</option>
                                <!-- <option class="sort sortByPriceDesc"></option> -->
                            </select>
                        </div>

                        <!--================= 一般商品卡片 =================-->
                        <div class="normalBlack">
                            <div id="app" class="addDivForVue">
                                <!-- =================放置動態「一般商品」的卡片================= -->
                                <div v-for="prodRow in prodRows" v-bind:id="prodRow.PRODNO" v-bind:class="[name1, name2, 'category'+prodRow.PRODCLNO]" >
                                    <a href="NormalProduct_RWD.html">
                                        <img :src="prodRow.PRODPIC_1" class="theImg">
                                    </a>
                                    <div class="productInfo">
                                        <p class="NameAndPrice">{{prodRow.PRODNAME}}</p>
                                        <p class="NameAndPrice">NT$
                                            <span class="price">{{prodRow.PRODPRICE}}</span>
                                            <button class="CartBtnOfMall">
                                                <i class="fas fa-shopping-cart fa-1x"></i>
                                                <p>加入購物車</p>
                                            </button>
                                        </p>
                                    </div>
                                </div>
                                <!-- =================放置動態「一般商品」的卡片//=============== -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ====================== 推薦商品(最新商品) =========================== -->
            <!-- ====================== 推薦商品(最新商品) =========================== -->
            <!-- ========標題======== -->
            <div class="newsPorTitle">
                <p>NEWS PORDUCTS</p>
                <h5>最新商品</h5>
                <div class="newProLine"></div>
            </div>
            <div class="sizeBoxC">
                <div class="homePage4__generalBlock">
                    <!--================= 推薦商品卡片 =================-->
                    <div id="appNewProd" class="addDivForVue">
                        <!-- =================放置動態「推薦商品」的卡片================= -->
                        <div v-for="NewProdRow in NewProdRows" class="product" v-bind:id="NewProdRow.PRODNO">
                            <a href="NormalProduct_RWD.html">
                                <img :src="NewProdRow.PRODPIC_1" class="theImg">
                            </a>
                            <div class="productInfo">
                                <p class="NameAndPrice">{{NewProdRow.PRODNAME}}</p>
                                <p class="NameAndPrice">NT$
                                    <span class="price">{{NewProdRow.PRODPRICE}}</span>
                                    <button class="CartBtnOfMall">
                                        <i class="fas fa-shopping-cart fa-1x"></i>
                                        <p>加入購物車</p>
                                    </button>
                                </p>
                            </div>
                        </div>
                        <!-- =================放置動態「推薦商品」的卡片//================= -->
                    </div>
                </div>
            </div>
        </div>
    </section> 

    <!-- 樣板 footer -->
    @@include('./layout/footer.html')
    <script src="./js/login.js"></script>
    <!-- Swiper JS -->
    <script src="./js/swiper-bundle.js"></script>
    <!-- Initialize Swiper -->
    <script src="./js/swiper-all.js"></script>

    <script>
        var swiper3 = new Swiper('#swiper3', {
            slidesPerView:1,
            breakpoints:{
            },
            // mousewheel: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
                effect: 'fade',
            },
        });
    </script>

    <script>
        $(function(){
            // 點擊
            $(".productType").on("click", function(){
            // -open 的樣式切換
            $(".type").closest(".type").toggleClass("-open");
            });
        });
    </script>
    <!-- ==================================篩選一般商品種類================================== -->
    <!-- ==================================篩選一般商品種類================================== -->
    <script>
        $(function(){
            // 點擊[所有一般商品]，可以所有商品都顯示
            $('#allNormalProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','block');
            });
            // 點擊[購物袋]，只顯示購物袋 種類category=0購物袋
            $('#ShopingBagProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category0').css('display','block');
            });
            // 點擊[杯套]，只顯示杯套 種類category=1杯套
            $('#CupsetProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category1').css('display','block');
            });
            // 點擊[口罩]，只顯示口罩 種類category=2口罩
            $('#FacemaskProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category2').css('display','block');
            });
            // 點擊[手機殼]，只顯示手機殼 種類category=3手機殼
            $('#PhonecaseProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category3').css('display','block');
            });
            // 點擊[上衣]，只顯示上衣 種類category=4上衣
            $('#TshirtProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category4').css('display','block');
            });
            // 點擊[帽子]，只顯示帽子 種類category=5帽子
            $('#HatProd').click(function(){
                $('.type').css('background-color','#FFFFFF');
                $(this).css('background-color','#FFD241');
                $('.productDisplay').css('display','none');
                $('.category5').css('display','block');
            });
        });
     </script>
    <!-- ==============================篩選一般商品種類//================================ -->
    <!-- ==============================篩選一般商品種類//================================ -->

        
    <!-- ====================================商城排序====================================-->
    <script>
        var select = document.getElementsByClassName("select_sort_way")[0];
        select.onchange = function(e){
            // alert(select.value);
            // 選到1，用「上市日期」排序(新到舊)
            if(select.value == 1){
                let xhrSortByDate = new XMLHttpRequest();
                xhrSortByDate.onload = function(){
                    prodRows = JSON.parse(xhrSortByDate.responseText);
                    app.prodRows = prodRows;
                }
                xhrSortByDate.open("get", "./php/mall/getProductsSortByListedDate.php", true);
                xhrSortByDate.send(null);
            // 選到2，用「商品價格」排序(低到高)
            }else if(select.value == 2){
                let xhrSortByPrice = new XMLHttpRequest();
                xhrSortByPrice.onload = function(){
                    prodRows = JSON.parse(xhrSortByPrice.responseText);
                    app.prodRows = prodRows;
                }
                xhrSortByPrice.open("get", "./php/mall/getProductsSortByPriceAsc.php", true);
                xhrSortByPrice.send(null);
            }
        };
    </script>
    <!-- ====================================商城排序//==================================-->


    <!-- =====================資料庫取資料 / 取資料 / 存id到session====================== -->
    <script>
        
    let cart=[];
    let storage = sessionStorage;

    // ---------到資料庫撈取「商城卡片」要的資料---------
    function getProducts(){
        let xhr = new XMLHttpRequest();
        xhr.onload = function(){
            prodRows = JSON.parse(xhr.responseText);
            app.prodRows = prodRows;
        }
        xhr.open("get", "./php/mall/getProducts.php", true);
        xhr.send(null);
    };
    // ------------把撈取到的一般商品動態渲染到「一般商品卡片」-------------
    // ------------把click到的商品id記錄到seccion (以便商品頁能取值)-------
    // ------------把click到的CartBtn記錄到seccion(以便購物車能取值)-------
    var app = new Vue({
        el: '#app',
        data: {
            prodRows: [],
            name1 : 'product',
            name2 : 'productDisplay',
        },
        mounted(){
            //ItemId : for商城記錄click到哪個商品
            if(storage['ItemId'] == null){
                storage['ItemId'] = '';
            }
            setTimeout(()=>{
                //幫每張卡片(一般商品+推薦商品)建立事件聆聽功能
                let prodCard = document.querySelectorAll('.theImg');
                for(let i = 0; i < prodCard.length; i++){
                    prodCard[i].addEventListener('click',function(){
                        // theId = this.id;(原寫法)
                        var theId = this.parentNode.parentNode.id;
                        //click後 就把theId = this.id存入session(下列三種寫法都可以)
                        storage.setItem('ItemId',theId);
                        // storage['ItemId'] = theId;
                        // storage['ItemId'] = `${theId}`;
                    });
                }
                //--------session記錄購物資訊-----更新storage的購物資訊
                function updateCart(){
                    storage["cart"] = JSON.stringify(cart);
                }
                // ********click「Cart Btn」, 就把 那個產品資訊存入Session********
                //-----------------------------註冊放入購物車
                let CartBtn = document.querySelectorAll('.CartBtnOfMall');
                for(let i=0; i<CartBtn.length; i++){
                    CartBtn[i].onclick = function(e){
                        // let prodNo = e.target.id;(原寫法)
                        let prodNo = this.parentNode.parentNode.parentNode.id;
                        //---------檢查商品是否已在cart中
                        let exist = false;
                        for(let i=0; i<cart.length; i++){
                            if(cart[i].prodNo == prodNo){
                                exist = true;
                                break;
                            }
                        }
                        //---------
                        if(exist){
                            alert("購物車內已有此商品囉!");
                        }else{
                            let item = {};
                            item.prodNo = prodNo;
                            item.prodName = e.target.parentNode.parentNode.parentNode.firstChild.innerText;
                            item.src = e.target.parentNode.parentNode.parentNode.previousElementSibling.firstChild.src;
                            item.price = e.target.parentNode.previousElementSibling.innerText;
                            item.count = 1;
                            cart.push(item);
                            updateCart(); 
                        }
                    }
                }
                //----------------------------
            },100)
        },
    });
    // ------------------------到資料庫撈取「推薦商品卡片」要的資料---------------------
    function getNewProducts(){
        let xhrNewProuct = new XMLHttpRequest();
        xhrNewProuct.onload = function(){
            NewProdRows = JSON.parse(xhrNewProuct.responseText);
            appNewProd.NewProdRows = NewProdRows;
        }
        xhrNewProuct.open("get", "./php/mall/getNewProducts.php", true);
        xhrNewProuct.send(null);
    }
    // ------------------------把撈取到的推薦商品動態渲染到「推薦商品卡片」-------------
    var appNewProd = new Vue({
        el: '#appNewProd',
        data: {
            NewProdRows: [],
        },
    });
    // ------------------------------------------------------------------------------
    function getCart(){
        if(storage["cart"] != undefined){
           cart = JSON.parse(storage["cart"]);
        }
    }
    window.addEventListener("load", function(){
        // 執行:撈取「一般商品」函式
        getProducts();  
        // 執行:撈取「推薦商品」函式
        getNewProducts();
        //=============cart
        getCart();
    })
    </script>
    <!-- 也可以用這種方式連到商品頁，再解析網址上的id值，去資料庫撈資料 -->
    <!-- <script>
        let id = $('#test').attr('id')
        $('#test').click(function(){
            location.href=`NormalProduct_RWD.html?id=${id}`;
        })
    </script> -->
</body>
</html>
